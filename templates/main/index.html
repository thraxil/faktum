{% extends 'base.html' %}
{% load markup %}
{% block js %}
<script src="/site_media/js/jquery-1.4.2.min.js"></script>
{% endblock %}

{% block css %}
<style type="text/css">
.add-fact input { width: 100%; }
.add-fact textarea { width: 100%; }

</style>
{% endblock %}
{% block title %}Welcome{% endblock %}

{% block content %}

{% if request.user.is_authenticated %}
<p><a href="#add-form" class="add-form-opener"
      onclick="window.toggleForm();return false"><i class="icon-plus"></i>add fact</a></p>
<div id="add-form" class="{% if not source_url %}hide{% endif %}">
<form action="/add/" method="post" class="add-fact">

<div class="row">
  <div class="span6">  
      <input type="text" name="title" placeholder="title" />
  </div>

  <div class="span6">
      <textarea name="details" rows="5" placeholder="details">{{details}}</textarea>
  </div>
</div>

<div class="row">
  <div class="span6">
      <input type="text" name="source_name" value="{{source_name}}"
      placeholder="source name"/>
  </div>
  <div class="span6">
      <input type="text" name="source_url" value="{{source_url}}"
      placeholder="source URL"/>
  </div>
</div>

<div class="row">
<div class="span6">
    <input type="text" name="tags" placeholder="tags" />
</div>
<div class="span6">
<input type="submit" value="add fact" class="btn btn-primary" />
</form>

(<a href="javascript:window.location='http://faktum.thraxil.org/?source_url='+escape(window.location)+';source_name='+escape(document.title)+';details='+escape((window.getSelection)?window.getSelection():document.getSelection());">bookmarklet</a>)
</div>
</div>
</div>

<br style="clear: both" />
{% endif %}

{% for fact in facts.object_list %}
<div class="fact row" id="fact-{{fact.id}}">
<div class="span6"><h2>{{fact.title}}</h2></div>
<div class="span6 details">{{fact.details|markdown}}
{% if fact.facttag_set.count %}
<div class="tags"><i class="icon-tags"></i> <b>Tags:</b>
{% for ft in fact.facttag_set.all %}
<a href="{{ft.tag.get_absolute_url}}">{{ft.tag.name}}</a>
{% endfor %}
</div>
{% endif %}
<div class="source"><b>Source</b>: {% if fact.source_url %}<a href="{{fact.source_url}}">{% endif %}{{fact.source_name}}{% if fact.source_url %}</a>{% endif %}</div>
<div class="added">added <a href="{{fact.get_absolute_url}}">{{fact.added}}</a> by {{fact.user.username}}</div></div>
</div>

{% endfor %}

<div class="pagination">
    <span class="step-links">
        {% if facts.has_previous %}
            <a href="?page={{ facts.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ facts.number }} of {{ facts.paginator.num_pages }}.
        </span>

        {% if facts.has_next %}
            <a href="?page={{ facts.next_page_number }}">next</a>
        {% endif %}
    </span>
</div>

<script>
var toggleForm = function() {
  $("#add-form").toggleClass("hide");
};
</script>
{% endblock %}
